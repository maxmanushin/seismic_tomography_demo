# Сейсмотомография — интерактивное объяснение

Небольшой учебный проект, который помогает шаг за шагом рассказать другу,
как устроена продольная сейсмотомография: от аналитических годографов
рефрагированных волн и «метода пристрелки» до прямолучевой инверсии с
градиентным обновлением модели скорости.

## Что внутри

- `tomography/` — модуль с ключевыми компонентами:
  - `grid.py`: двумерная модель скорости на сетке и 1D послойная модель.
  - `geometry.py`: описание схемы источников и приёмников.
  - `ray_tracing.py`: прямые лучи, годографы и построение траектории головной волны.
  - `inversion.py`: расчёт невязки, градиента и Тихоновской регуляризации.
  - `synthetic.py`: генерация синтетического примера с гауссовой аномалией.
- `app.py` — приложение Streamlit для интерактивной визуализации.
- `pyproject.toml` — декларация проекта для [uv](https://github.com/astral-sh/uv).
- `__init__.py` — экспорт основных функций пакета на верхний уровень.

## Быстрый старт через uv

В репозитории лежит `pyproject.toml`, так что самый быстрый способ поднять среду —
[uv](https://github.com/astral-sh/uv):

```bash
uv venv
source .venv/bin/activate
uv sync
```

Команда `uv sync` создаст виртуальное окружение и поставит зависимости (`numpy`,
`streamlit`, `matplotlib`). Если uv недоступен, воспользуйтесь стандартным `pip`:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install numpy streamlit matplotlib
```

## Как запустить визуализацию

1. Активируйте виртуальное окружение (если создавали).
2. Выполните:

   ```bash
   streamlit run app.py
   ```

3. Откройте в браузере ссылку, которую выдаст Streamlit (обычно http://localhost:8501).

## Что показывает приложение

- **Сценарий** — выбор геологической или простой горизонтальной модели, сид генерации и кнопка для перезапуска случайной среды.
- **Стартовая модель** — ползунки для ручного задания скоростей слоёв и кнопка применения новой стартовой модели.
- **Инверсия** — предел поправки скорости, плотность дискретизации лучей, параметры регуляризации и диапазон допустимых скоростей.
- **Графики**:
  - истинная и текущая модели скорости;
  - карта градиента, гистограмма невязки и история изменения ½‖r‖²;
  - годограф прямой и головной волн с отметками точки схождения и времени подхода;
  - сравнённые траектории «критического» и «пробного» лучей для метода пристрелки.
- Вкладка «Гайд» содержит план рассказа и основные тезисы для собеседника.

## Сценарии и стартовая модель

- **Геологическая сцена** — волнистые границы слоя с локальными аномалиями; сид можно
  менять, чтобы получать новые комбинации. Стартовая модель плоская, пригодна для
  иллюстрации, как инверсия заполняет детали.
- **Простая горизонтальная сцена** — случайный набор горизонтальных слоёв без
  волнистости, полезен для обсуждения 1D-инверсии.
- В блоке «Стартовая модель» можно руками выставить скорости слоёв, затем нажать
  «Применить стартовую модель», чтобы обновить исходное состояние и ссылку для
  регуляризации.

## Возможные продолжения

- Добавить более сложное лучепреломление (непрямолинейные траектории).
- Ввести адаптивный подбор шага и автоматическую остановку по невязке.
- Сохранить историю итераций для сравнения сходимости.

Приятных экспериментов и удачных объяснений!
